<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1508px" preserveAspectRatio="none" style="width:807px;height:1508px;background:#FFFFFF;" version="1.1" viewBox="0 0 807 1508" width="807px" zoomAndPan="magnify"><defs><filter height="300%" id="f10tihwd9iuxlw" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="56.2656" style="stroke:#000000;stroke-width:2.0;" width="372" x="75" y="68.5938"/><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="157.7969" style="stroke:#000000;stroke-width:2.0;" width="664.5" x="8" y="142.8594"/><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="246.1953" style="stroke:#000000;stroke-width:2.0;" width="555" x="56" y="318.6563"/><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="143.7969" style="stroke:#000000;stroke-width:2.0;" width="511" x="75" y="407.0547"/><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="718.0625" style="stroke:#000000;stroke-width:2.0;" width="756" x="37" y="582.8516"/><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="672.9297" style="stroke:#000000;stroke-width:2.0;" width="712" x="56" y="613.9844"/><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="125.6641" style="stroke:#000000;stroke-width:2.0;" width="475.5" x="150.5" y="974.8438"/><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="154.4063" style="stroke:#000000;stroke-width:2.0;" width="511" x="75" y="1118.5078"/><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="157.7969" style="stroke:#000000;stroke-width:2.0;" width="597.5" x="75" y="1318.9141"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="91" x2="91" y1="56.5938" y2="1500.7109"/><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="1330.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="86" y="169.9922"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="347" x2="347" y1="56.5938" y2="1500.7109"/><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="1322.7188" style="stroke:#A80036;stroke-width:1.0;" width="10" x="342" y="116.8594"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="610" x2="610" y1="56.5938" y2="1500.7109"/><rect fill="#FFFFFF" filter="url(#f10tihwd9iuxlw)" height="1133.9219" style="stroke:#A80036;stroke-width:1.0;" width="10" x="605" y="292.6563"/><rect fill="#FEFECE" filter="url(#f10tihwd9iuxlw)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="24" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="116" x="31" y="41.292">Main component</text><rect fill="#FEFECE" filter="url(#f10tihwd9iuxlw)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="164" x="263" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="150" x="270" y="24.9951">Watching Component</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="112" x="289" y="41.292">Remote or Local</text><rect fill="#FEFECE" filter="url(#f10tihwd9iuxlw)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="89" x="563.5" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="75" x="570.5" y="41.292">Blockchain</text><path d="M75,68.5938 L247,68.5938 L247,75.5938 L237,85.5938 L75,85.5938 L75,68.5938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="56.2656" style="stroke:#000000;stroke-width:2.0;" width="372" x="75" y="68.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="127" x="90" y="81.6606">Initialize Watcher</text><polygon fill="#A80036" points="330,112.8594,340,116.8594,330,120.8594,334,116.8594" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="91" x2="336" y1="116.8594" y2="116.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="98" y="111.7935">NewWatcher</text><path d="M8,142.8594 L142,142.8594 L142,149.8594 L132,159.8594 L8,159.8594 L8,142.8594 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="157.7969" style="stroke:#000000;stroke-width:2.0;" width="664.5" x="8" y="142.8594"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="89" x="23" y="155.9263">Open phase</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="138" y1="191.125" y2="191.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="138" y1="191.125" y2="204.125"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97" x2="138" y1="204.125" y2="204.125"/><polygon fill="#A80036" points="107,200.125,97,204.125,107,208.125,103,204.125" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="103" y="186.0591">Open Channel</text><polygon fill="#A80036" points="330,229.2578,340,233.2578,330,237.2578,334,233.2578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="336" y1="233.2578" y2="233.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="105" x="103" y="228.1919">StartWatching</text><polygon fill="#A80036" points="593,288.6563,603,292.6563,593,296.6563,597,292.6563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="599" y1="292.6563" y2="292.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="234" x="359" y="257.3247">RegistererSubscriber.Subscribe</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="207" x="359" y="272.4575">(Subscribe to adjudicator events</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="120" x="359" y="287.5903">for this channel ID)</text><path d="M56,318.6563 L214,318.6563 L214,325.6563 L204,335.6563 L56,335.6563 L56,318.6563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="246.1953" style="stroke:#000000;stroke-width:2.0;" width="555" x="56" y="318.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="113" x="71" y="331.7231">Transact phase</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="138" y1="382.0547" y2="382.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="138" y1="382.0547" y2="395.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97" x2="138" y1="395.0547" y2="395.0547"/><polygon fill="#A80036" points="107,391.0547,97,395.0547,107,399.0547,103,395.0547" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="93" x="103" y="361.856">Make off-chain</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="79" x="103" y="376.9888">transactions</text><path d="M75,407.0547 L145,407.0547 L145,414.0547 L135,424.0547 L75,424.0547 L75,407.0547 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="143.7969" style="stroke:#000000;stroke-width:2.0;" width="511" x="75" y="407.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="90" y="420.1216">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="85" x="160" y="419.2651">[Periodically]</text><polygon fill="#A80036" points="330,466.4531,340,470.4531,330,474.4531,334,470.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="336" y1="470.4531" y2="470.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="135" x="103" y="450.2544">StatesPub.Publish</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="144" x="103" y="465.3872">(newer off-chain state)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="394" y1="529.8516" y2="529.8516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="394" x2="394" y1="529.8516" y2="542.8516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="353" x2="394" y1="542.8516" y2="542.8516"/><polygon fill="#A80036" points="363,538.8516,353,542.8516,363,546.8516,359,542.8516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126" x="359" y="494.52">StatesSub.Next()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="162" x="359" y="509.6528">(Receive the newer state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="359" y="524.7856">store it &amp; discard the older one)</text><path d="M37,582.8516 L194,582.8516 L194,589.8516 L184,599.8516 L37,599.8516 L37,582.8516 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="718.0625" style="stroke:#000000;stroke-width:2.0;" width="756" x="37" y="582.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="112" x="52" y="595.9185">Register phase</text><path d="M56,613.9844 L133,613.9844 L133,620.9844 L123,630.9844 L56,630.9844 L56,613.9844 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="672.9297" style="stroke:#000000;stroke-width:2.0;" width="712" x="56" y="613.9844"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="32" x="71" y="627.0513">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="296" x="148" y="626.1948">[until the stop watching command it received]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="615" x2="657" y1="677.3828" y2="677.3828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="657" x2="657" y1="677.3828" y2="690.3828"/><line style="stroke:#A80036;stroke-width:1.0;" x1="616" x2="657" y1="690.3828" y2="690.3828"/><polygon fill="#A80036" points="626,686.3828,616,690.3828,626,694.3828,622,690.3828" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="123" x="622" y="657.1841">State registered by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="95" x="622" y="672.3169">any participant</text><polygon fill="#A80036" points="363,730.6484,353,734.6484,363,738.6484,359,734.6484" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="357" x2="604" y1="734.6484" y2="734.6484"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="221" x="369" y="714.4497">AdjudicatorEventsSub.Publish</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="118" x="369" y="729.5825">(Registered event)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="394" y1="809.1797" y2="809.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="394" x2="394" y1="809.1797" y2="822.1797"/><line style="stroke:#A80036;stroke-width:1.0;" x1="353" x2="394" y1="822.1797" y2="822.1797"/><polygon fill="#A80036" points="363,818.1797,353,822.1797,363,826.1797,359,822.1797" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="213" x="359" y="758.7153">AdjudicatorEventsSub.Next()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191" x="359" y="773.8481">(Receive the Registered event</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="201" x="359" y="788.981">and relay it to main component</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="359" y="804.1138">before processing)</text><path d="M111.5,835.1797 L111.5,875.1797 L578.5,875.1797 L578.5,845.1797 L568.5,835.1797 L111.5,835.1797 " fill="#D3D3D3" filter="url(#f10tihwd9iuxlw)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M568.5,835.1797 L568.5,845.1797 L578.5,845.1797 L568.5,835.1797 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="446" x="117.5" y="852.2466">If it is not the latest state, still notify before refuting. So that, the main</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="431" x="117.5" y="867.3794">component can act appropriately while the refutation is in progress.</text><polygon fill="#A80036" points="107,916.7109,97,920.7109,107,924.7109,103,920.7109" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101" x2="341" y1="920.7109" y2="920.7109"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="222" x="113" y="900.5122">AdjudicatorEventsPub.Publish</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="211" x="113" y="915.645">(Registered or Progressed event)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="138" y1="949.8438" y2="949.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="138" y1="949.8438" y2="962.8438"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97" x2="138" y1="962.8438" y2="962.8438"/><polygon fill="#A80036" points="107,958.8438,97,962.8438,107,966.8438,103,962.8438" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="213" x="103" y="944.7778">AdjudicatorEventsSub.Next()</text><path d="M150.5,974.8438 L220.5,974.8438 L220.5,981.8438 L210.5,991.8438 L150.5,991.8438 L150.5,974.8438 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="125.6641" style="stroke:#000000;stroke-width:2.0;" width="475.5" x="150.5" y="974.8438"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="165.5" y="987.9106">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="207" x="235.5" y="987.0542">[if registered state is not latest]</text><polygon fill="#A80036" points="593,1034.2422,603,1038.2422,593,1042.2422,597,1038.2422" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="599" y1="1038.2422" y2="1038.2422"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="223" x="359" y="1018.0435">RegistererSubscriber.Register</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="216" x="359" y="1033.1763">(Refute with latest off-chain state)</text><path d="M171.5,1051.2422 L171.5,1091.2422 L518.5,1091.2422 L518.5,1061.2422 L508.5,1051.2422 L171.5,1051.2422 " fill="#D3D3D3" filter="url(#f10tihwd9iuxlw)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M508.5,1051.2422 L508.5,1061.2422 L518.5,1061.2422 L508.5,1051.2422 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="293" x="177.5" y="1068.3091">Once refutation succeeds, watcher will receive</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="326" x="177.5" y="1083.4419">another Registered event on AdjudicatorEventsSub</text><path d="M75,1118.5078 L145,1118.5078 L145,1125.5078 L135,1135.5078 L75,1135.5078 L75,1118.5078 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="154.4063" style="stroke:#000000;stroke-width:2.0;" width="511" x="75" y="1118.5078"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="25" x="90" y="1131.5747">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="208" x="160" y="1130.7183">[if main component has not sent</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacing" textLength="202" x="160" y="1143.5229">the latest state to the watcher]</text><polygon fill="#A80036" points="330,1188.5156,340,1192.5156,330,1196.5156,334,1192.5156" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="336" y1="1192.5156" y2="1192.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="135" x="103" y="1172.3169">StatesPub.Publish</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="103" y="1187.4497">(latest off-chain state)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="394" y1="1251.9141" y2="1251.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="394" x2="394" y1="1251.9141" y2="1264.9141"/><line style="stroke:#A80036;stroke-width:1.0;" x1="353" x2="394" y1="1264.9141" y2="1264.9141"/><polygon fill="#A80036" points="363,1260.9141,353,1264.9141,363,1268.9141,359,1264.9141" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="126" x="359" y="1216.5825">StatesSub.Next()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="160" x="359" y="1231.7153">(Receive the latest state,</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="204" x="359" y="1246.8481">store it &amp; discard the older one)</text><path d="M75,1318.9141 L213,1318.9141 L213,1325.9141 L203,1335.9141 L75,1335.9141 L75,1318.9141 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="157.7969" style="stroke:#000000;stroke-width:2.0;" width="597.5" x="75" y="1318.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="93" x="90" y="1331.981">Settle phase</text><polygon fill="#A80036" points="330,1363.1797,340,1367.1797,330,1371.1797,334,1367.1797" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="336" y1="1367.1797" y2="1367.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="101" x="103" y="1362.1138">Stopwatching</text><polygon fill="#A80036" points="593,1422.5781,603,1426.5781,593,1430.5781,597,1426.5781" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="352" x2="599" y1="1426.5781" y2="1426.5781"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="219" x="359" y="1391.2466">AdjudicatorEventsSub.Close()</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="5" x="578" y="1391.2466">(</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="188" x="359" y="1406.3794">Unsubscribe from adjudicator</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="150" x="359" y="1421.5122">events for this channel)</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="138" y1="1455.7109" y2="1455.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="138" y1="1455.7109" y2="1468.7109"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97" x2="138" y1="1468.7109" y2="1468.7109"/><polygon fill="#A80036" points="107,1464.7109,97,1468.7109,107,1472.7109,103,1468.7109" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="92" x="103" y="1450.645">Settle channel</text><!--MD5=[d5b380daa467a85e99591d934e7c1e24]
@startuml watcher
!pragma teoz true
hide footbox

participant "Main component" as main_component
participant "Watching Component\nRemote or Local" as watcher
participant "Blockchain" as blockchain

group Initialize Watcher
main_component -> watcher: NewWatcher
activate watcher
end

group Open phase
activate main_component
main_component -> main_component: Open Channel
main_component -> watcher: **StartWatching**
watcher -> blockchain: **RegistererSubscriber.Subscribe**\n(Subscribe to adjudicator events\nfor this channel ID)
activate blockchain
end

group Transact phase
main_component -> main_component: Make off-chain\ntransactions
opt Periodically
main_component -> watcher: **StatesPub.Publish**\n(newer off-chain state)
watcher -> watcher: **StatesSub.Next()**\n(Receive the newer state,\nstore it & discard the older one)
end
end

group Register phase
loop until the stop watching command it received
blockchain -> blockchain: State registered by\nany participant
watcher <- blockchain:**AdjudicatorEventsSub.Publish**\n(Registered event)
watcher -> watcher:**AdjudicatorEventsSub.Next()**\n(Receive the Registered event\nand relay it to main component\nbefore processing)
note over watcher #LightGray
If it is not the latest state, still notify before refuting. So that, the main
component can act appropriately while the refutation is in progress.
end note
main_component <- watcher: **AdjudicatorEventsPub.Publish**\n(Registered or Progressed event)
main_component -> main_component: **AdjudicatorEventsSub.Next()**
opt if registered state is not latest
watcher -> blockchain: **RegistererSubscriber.Register**\n(Refute with latest off-chain state)
note over watcher #LightGray
Once refutation succeeds, watcher will receive
another Registered event on AdjudicatorEventsSub
end note
end
opt if main component has not sent\nthe latest state to the watcher
main_component -> watcher: **StatesPub.Publish**\n(latest off-chain state)
watcher -> watcher: **StatesSub.Next()**\n(Receive the latest state,\nstore it & discard the older one)
end
end
end


group Settle phase 
main_component -> watcher: **Stopwatching**
watcher -> blockchain: **AdjudicatorEventsSub.Close()**(\nUnsubscribe from adjudicator\nevents for this channel)
deactivate blockchain
deactivate watcher
main_component -> main_component: Settle channel
end

@enduml

PlantUML version 1.2021.9(Sun Jul 25 15:43:56 IST 2021)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: IN
--></g></svg>