<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="887px" preserveAspectRatio="none" style="width:528px;height:887px;" version="1.1" viewBox="0 0 528 887" width="528px" zoomAndPan="magnify"><defs><filter height="300%" id="f28fjutu81ixa" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#f28fjutu81ixa)" height="93.3984" style="stroke:#000000;stroke-width:2.0;" width="363" x="8" y="68.5938"/><rect fill="#FFFFFF" filter="url(#f28fjutu81ixa)" height="185.7969" style="stroke:#000000;stroke-width:2.0;" width="413" x="56" y="174.9922"/><rect fill="#FFFFFF" filter="url(#f28fjutu81ixa)" height="108.5313" style="stroke:#000000;stroke-width:2.0;" width="369" x="75" y="243.2578"/><rect fill="#FFFFFF" filter="url(#f28fjutu81ixa)" height="380.3359" style="stroke:#000000;stroke-width:2.0;" width="477.5" x="37" y="373.7891"/><rect fill="#FFFFFF" filter="url(#f28fjutu81ixa)" height="345.2031" style="stroke:#000000;stroke-width:2.0;" width="433.5" x="56" y="399.9219"/><rect fill="#FFFFFF" filter="url(#f28fjutu81ixa)" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="387" x="77.5" y="527.5859"/><rect fill="#FFFFFF" filter="url(#f28fjutu81ixa)" height="61.875" style="stroke:#000000;stroke-width:2.0;" width="309" x="75" y="674.25"/><rect fill="#FFFFFF" filter="url(#f28fjutu81ixa)" height="93.3984" style="stroke:#000000;stroke-width:2.0;" width="296" x="75" y="767.125"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="91" x2="91" y1="56.5938" y2="879.5234"/><rect fill="#FFFFFF" filter="url(#f28fjutu81ixa)" height="788.7969" style="stroke:#A80036;stroke-width:1.0;" width="10" x="86" y="90.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="271" x2="271" y1="56.5938" y2="879.5234"/><rect fill="#FFFFFF" filter="url(#f28fjutu81ixa)" height="656.3984" style="stroke:#A80036;stroke-width:1.0;" width="10" x="266" y="153.9922"/><rect fill="#FEFECE" filter="url(#f28fjutu81ixa)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="24" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="31" y="41.292">Main component</text><rect fill="#FEFECE" filter="url(#f28fjutu81ixa)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="164" x="187" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="150" x="194" y="24.9951">Watching Component</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="213" y="41.292">Remote or Local</text><path d="M8,68.5938 L142,68.5938 L142,75.5938 L132,85.5938 L8,85.5938 L8,68.5938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="93.3984" style="stroke:#000000;stroke-width:2.0;" width="363" x="8" y="68.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="23" y="81.6606">Open phase</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="138" y1="111.8594" y2="111.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="138" y1="111.8594" y2="124.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97" x2="138" y1="124.8594" y2="124.8594"/><polygon fill="#A80036" points="107,120.8594,97,124.8594,107,128.8594,103,124.8594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="103" y="106.7935">Open Channel</text><polygon fill="#A80036" points="254,149.9922,264,153.9922,254,157.9922,258,153.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="260" y1="153.9922" y2="153.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="103" y="148.9263">Start Watching</text><path d="M56,174.9922 L214,174.9922 L214,181.9922 L204,191.9922 L56,191.9922 L56,174.9922 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="185.7969" style="stroke:#000000;stroke-width:2.0;" width="413" x="56" y="174.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="71" y="188.0591">Transact phase</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="138" y1="218.2578" y2="218.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="138" y1="218.2578" y2="231.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97" x2="138" y1="231.2578" y2="231.2578"/><polygon fill="#A80036" points="107,227.2578,97,231.2578,107,235.2578,103,231.2578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="103" y="213.1919">Off-chain transactions</text><path d="M75,243.2578 L145,243.2578 L145,250.2578 L135,260.2578 L75,260.2578 L75,243.2578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="108.5313" style="stroke:#000000;stroke-width:2.0;" width="369" x="75" y="243.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="90" y="256.3247">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="85" x="160" y="255.4683">[Periodically]</text><polygon fill="#A80036" points="254,282.5234,264,286.5234,254,290.5234,258,286.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="260" y1="286.5234" y2="286.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="103" y="281.4575">Updated off-chain state</text><line style="stroke:#A80036;stroke-width:1.0;" x1="276" x2="318" y1="330.7891" y2="330.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="318" y1="330.7891" y2="343.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="277" x2="318" y1="343.7891" y2="343.7891"/><polygon fill="#A80036" points="287,339.7891,277,343.7891,287,347.7891,283,343.7891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="283" y="310.5903">Store the new state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="283" y="325.7231">and discard older one</text><path d="M37,373.7891 L194,373.7891 L194,380.7891 L184,390.7891 L37,390.7891 L37,373.7891 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="380.3359" style="stroke:#000000;stroke-width:2.0;" width="477.5" x="37" y="373.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="52" y="386.856">Register phase</text><path d="M56,399.9219 L133,399.9219 L133,406.9219 L123,416.9219 L56,416.9219 L56,399.9219 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="345.2031" style="stroke:#000000;stroke-width:2.0;" width="433.5" x="56" y="399.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="71" y="412.9888">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="296" x="148" y="412.1323">[until the stop watching command it received]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="276" x2="318" y1="458.3203" y2="458.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="318" y1="458.3203" y2="471.3203"/><line style="stroke:#A80036;stroke-width:1.0;" x1="277" x2="318" y1="471.3203" y2="471.3203"/><polygon fill="#A80036" points="287,467.3203,277,471.3203,287,475.3203,283,471.3203" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="283" y="438.1216">State registered</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="283" y="453.2544">on the blockchain</text><polygon fill="#A80036" points="107,511.5859,97,515.5859,107,519.5859,103,515.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101" x2="265" y1="515.5859" y2="515.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="113" y="495.3872">State registered</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="113" y="510.52">on the blockchain</text><path d="M77.5,527.5859 L147.5,527.5859 L147.5,534.5859 L137.5,544.5859 L77.5,544.5859 L77.5,527.5859 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="387" x="77.5" y="527.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="92.5" y="540.6528">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="162.5" y="539.7964">[if registered state is not latest]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="276" x2="318" y1="585.9844" y2="585.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="318" y1="585.9844" y2="598.9844"/><line style="stroke:#A80036;stroke-width:1.0;" x1="277" x2="318" y1="598.9844" y2="598.9844"/><polygon fill="#A80036" points="287,594.9844,277,598.9844,287,602.9844,283,598.9844" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="283" y="565.7856">Register latest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="283" y="580.9185">off-chain state</text><path d="M98.5,611.9844 L98.5,651.9844 L439.5,651.9844 L439.5,621.9844 L429.5,611.9844 L98.5,611.9844 " fill="#D3D3D3" filter="url(#f28fjutu81ixa)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M429.5,611.9844 L429.5,621.9844 L439.5,621.9844 L429.5,611.9844 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="104.5" y="629.0513">Once this succeeds, watcher will receieve another</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="104.5" y="644.1841">"State registered on the blockchain" notification</text><path d="M75,674.25 L145,674.25 L145,681.25 L135,691.25 L75,691.25 L75,674.25 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.875" style="stroke:#000000;stroke-width:2.0;" width="309" x="75" y="674.25"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="90" y="687.3169">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="208" x="160" y="686.4604">[if main component has not sent</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="202" x="160" y="699.2651">the latest state to the watcher]</text><polygon fill="#A80036" points="254,724.125,264,728.125,254,732.125,258,728.125" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="260" y1="728.125" y2="728.125"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="103" y="723.0591">Latest off-chain state</text><path d="M75,767.125 L213,767.125 L213,774.125 L203,784.125 L75,784.125 L75,767.125 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="93.3984" style="stroke:#000000;stroke-width:2.0;" width="296" x="75" y="767.125"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="90" y="780.1919">Settle phase</text><polygon fill="#A80036" points="254,806.3906,264,810.3906,254,814.3906,258,810.3906" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="260" y1="810.3906" y2="810.3906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="103" y="805.3247">Stop watching</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="138" y1="839.5234" y2="839.5234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="138" y1="839.5234" y2="852.5234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97" x2="138" y1="852.5234" y2="852.5234"/><polygon fill="#A80036" points="107,848.5234,97,852.5234,107,856.5234,103,852.5234" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="103" y="834.4575">Settle channel</text><!--MD5=[302e589305faefb2afbf6f2a0983906c]
@startuml watcher
!pragma teoz true
hide footbox

participant "Main component" as main_component
participant "Watching Component\nRemote or Local" as watcher

group Open phase
activate main_component
main_component -> main_component: Open Channel
main_component -> watcher: Start Watching
activate watcher
end

group Transact phase 
main_component <-> main_component: Off-chain transactions
opt Periodically
main_component -> watcher: Updated off-chain state
watcher -> watcher: Store the new state\nand discard older one
end
end

group Register phase
loop until the stop watching command it received
watcher -> watcher: State registered\non the blockchain
main_component <- watcher: State registered\non the blockchain
opt if registered state is not latest
watcher -> watcher: Register latest\noff-chain state
note over watcher #LightGray
Once this succeeds, watcher will receieve another 
"State registered on the blockchain" notification
end note
end
opt if main component has not sent\nthe latest state to the watcher
main_component -> watcher: Latest off-chain state
end
end
end


group Settle phase 
main_component -> watcher: Stop watching
deactivate watcher
main_component -> main_component: Settle channel
end



@enduml

PlantUML version 1.2020.21(Mon Nov 30 22:10:11 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: IN
--></g></svg>