<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="1076px" preserveAspectRatio="none" style="width:696px;height:1076px;" version="1.1" viewBox="0 0 696 1076" width="696px" zoomAndPan="magnify"><defs><filter height="300%" id="fq54v7zze8h28" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fq54v7zze8h28)" height="137.6641" style="stroke:#000000;stroke-width:2.0;" width="514.5" x="47.5" y="68.5938"/><rect fill="#FFFFFF" filter="url(#fq54v7zze8h28)" height="185.7969" style="stroke:#000000;stroke-width:2.0;" width="413" x="95.5" y="219.2578"/><rect fill="#FFFFFF" filter="url(#fq54v7zze8h28)" height="108.5313" style="stroke:#000000;stroke-width:2.0;" width="369" x="114.5" y="287.5234"/><rect fill="#FFFFFF" filter="url(#fq54v7zze8h28)" height="481" style="stroke:#000000;stroke-width:2.0;" width="674.5" x="8" y="418.0547"/><rect fill="#FFFFFF" filter="url(#fq54v7zze8h28)" height="445.8672" style="stroke:#000000;stroke-width:2.0;" width="630.5" x="27" y="444.1875"/><rect fill="#FFFFFF" filter="url(#fq54v7zze8h28)" height="120.6641" style="stroke:#000000;stroke-width:2.0;" width="392.5" x="123" y="685.5156"/><rect fill="#FFFFFF" filter="url(#fq54v7zze8h28)" height="61.875" style="stroke:#000000;stroke-width:2.0;" width="309" x="114.5" y="819.1797"/><rect fill="#FFFFFF" filter="url(#fq54v7zze8h28)" height="137.6641" style="stroke:#000000;stroke-width:2.0;" width="447.5" x="114.5" y="912.0547"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="130.5" x2="130.5" y1="56.5938" y2="1068.7188"/><rect fill="#FFFFFF" filter="url(#fq54v7zze8h28)" height="977.9922" style="stroke:#A80036;stroke-width:1.0;" width="10" x="125.5" y="90.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="310.5" x2="310.5" y1="56.5938" y2="1068.7188"/><rect fill="#FFFFFF" filter="url(#fq54v7zze8h28)" height="809.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="305.5" y="198.2578"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="499.5" x2="499.5" y1="56.5938" y2="1068.7188"/><rect fill="#FFFFFF" filter="url(#fq54v7zze8h28)" height="793.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="494.5" y="206.2578"/><rect fill="#FEFECE" filter="url(#fq54v7zze8h28)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="63.5" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="70.5" y="41.292">Main component</text><rect fill="#FEFECE" filter="url(#fq54v7zze8h28)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="164" x="226.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="150" x="233.5" y="24.9951">Watching Component</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="252.5" y="41.292">Remote or Local</text><rect fill="#FEFECE" filter="url(#fq54v7zze8h28)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="89" x="453" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="75" x="460" y="41.292">Blockchain</text><path d="M47.5,68.5938 L181.5,68.5938 L181.5,75.5938 L171.5,85.5938 L47.5,85.5938 L47.5,68.5938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="137.6641" style="stroke:#000000;stroke-width:2.0;" width="514.5" x="47.5" y="68.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="62.5" y="81.6606">Open phase</text><line style="stroke:#A80036;stroke-width:1.0;" x1="135.5" x2="177.5" y1="111.8594" y2="111.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="177.5" x2="177.5" y1="111.8594" y2="124.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="136.5" x2="177.5" y1="124.8594" y2="124.8594"/><polygon fill="#A80036" points="146.5,120.8594,136.5,124.8594,146.5,128.8594,142.5,124.8594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="142.5" y="106.7935">Open Channel</text><polygon fill="#A80036" points="298.5,149.9922,308.5,153.9922,298.5,157.9922,302.5,153.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="135.5" x2="304.5" y1="153.9922" y2="153.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="142.5" y="148.9263">Start Watching</text><polygon fill="#A80036" points="487.5,194.2578,497.5,198.2578,487.5,202.2578,491.5,198.2578" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="315.5" x2="493.5" y1="198.2578" y2="198.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="127" x="322.5" y="178.0591">Subscribe to events</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="322.5" y="193.1919">for this channel ID</text><path d="M95.5,219.2578 L253.5,219.2578 L253.5,226.2578 L243.5,236.2578 L95.5,236.2578 L95.5,219.2578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="185.7969" style="stroke:#000000;stroke-width:2.0;" width="413" x="95.5" y="219.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="110.5" y="232.3247">Transact phase</text><line style="stroke:#A80036;stroke-width:1.0;" x1="135.5" x2="177.5" y1="262.5234" y2="262.5234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="177.5" x2="177.5" y1="262.5234" y2="275.5234"/><line style="stroke:#A80036;stroke-width:1.0;" x1="136.5" x2="177.5" y1="275.5234" y2="275.5234"/><polygon fill="#A80036" points="146.5,271.5234,136.5,275.5234,146.5,279.5234,142.5,275.5234" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="142.5" y="257.4575">Off-chain transactions</text><path d="M114.5,287.5234 L184.5,287.5234 L184.5,294.5234 L174.5,304.5234 L114.5,304.5234 L114.5,287.5234 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="108.5313" style="stroke:#000000;stroke-width:2.0;" width="369" x="114.5" y="287.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="129.5" y="300.5903">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="85" x="199.5" y="299.7339">[Periodically]</text><polygon fill="#A80036" points="293.5,326.7891,303.5,330.7891,293.5,334.7891,297.5,330.7891" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="135.5" x2="299.5" y1="330.7891" y2="330.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="142.5" y="325.7231">Updated off-chain state</text><line style="stroke:#A80036;stroke-width:1.0;" x1="315.5" x2="357.5" y1="375.0547" y2="375.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="357.5" x2="357.5" y1="375.0547" y2="388.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="316.5" x2="357.5" y1="388.0547" y2="388.0547"/><polygon fill="#A80036" points="326.5,384.0547,316.5,388.0547,326.5,392.0547,322.5,388.0547" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="322.5" y="354.856">Store the new state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="322.5" y="369.9888">and discard older one</text><path d="M8,418.0547 L165,418.0547 L165,425.0547 L155,435.0547 L8,435.0547 L8,418.0547 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="481" style="stroke:#000000;stroke-width:2.0;" width="674.5" x="8" y="418.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="23" y="431.1216">Register phase</text><path d="M27,444.1875 L104,444.1875 L104,451.1875 L94,461.1875 L27,461.1875 L27,444.1875 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="445.8672" style="stroke:#000000;stroke-width:2.0;" width="630.5" x="27" y="444.1875"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="42" y="457.2544">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="296" x="119" y="456.3979">[until the stop watching command it received]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="504.5" x2="546.5" y1="502.5859" y2="502.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="546.5" x2="546.5" y1="502.5859" y2="515.5859"/><line style="stroke:#A80036;stroke-width:1.0;" x1="505.5" x2="546.5" y1="515.5859" y2="515.5859"/><polygon fill="#A80036" points="515.5,511.5859,505.5,515.5859,515.5,519.5859,511.5,515.5859" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="123" x="511.5" y="482.3872">State registered by</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="95" x="511.5" y="497.52">any participant</text><polygon fill="#A80036" points="326.5,555.8516,316.5,559.8516,326.5,563.8516,322.5,559.8516" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="320.5" x2="493.5" y1="559.8516" y2="559.8516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="332.5" y="539.6528">State registered</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="332.5" y="554.7856">on the blockchain</text><polygon fill="#A80036" points="146.5,600.1172,136.5,604.1172,146.5,608.1172,142.5,604.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="140.5" x2="304.5" y1="604.1172" y2="604.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="152.5" y="583.9185">State registered</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="152.5" y="599.0513">on the blockchain</text><path d="M48,617.1172 L48,672.1172 L389,672.1172 L389,627.1172 L379,617.1172 L48,617.1172 " fill="#D3D3D3" filter="url(#fq54v7zze8h28)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M379,617.1172 L379,627.1172 L389,627.1172 L379,617.1172 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="320" x="54" y="634.1841">This update is sent to inform the main component</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="311" x="54" y="649.3169">that state has been registered and refutation will</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="54" y="664.4497">be automatically done by the watcher, if required.</text><path d="M123,685.5156 L193,685.5156 L193,692.5156 L183,702.5156 L123,702.5156 L123,685.5156 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="120.6641" style="stroke:#000000;stroke-width:2.0;" width="392.5" x="123" y="685.5156"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="138" y="698.5825">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="208" y="697.7261">[if registered state is not latest]</text><polygon fill="#A80036" points="482.5,739.9141,492.5,743.9141,482.5,747.9141,486.5,743.9141" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="315.5" x2="488.5" y1="743.9141" y2="743.9141"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="322.5" y="723.7153">Register latest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="322.5" y="738.8481">off-chain state</text><path d="M144,756.9141 L144,796.9141 L473,796.9141 L473,766.9141 L463,756.9141 L144,756.9141 " fill="#D3D3D3" filter="url(#fq54v7zze8h28)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M463,756.9141 L463,766.9141 L473,766.9141 L463,756.9141 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="308" x="150" y="773.981">Once this succeeds, watcher will receive another</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="150" y="789.1138">"State registered on the blockchain" notification</text><path d="M114.5,819.1797 L184.5,819.1797 L184.5,826.1797 L174.5,836.1797 L114.5,836.1797 L114.5,819.1797 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.875" style="stroke:#000000;stroke-width:2.0;" width="309" x="114.5" y="819.1797"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="129.5" y="832.2466">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="208" x="199.5" y="831.3901">[if main component has not sent</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="202" x="199.5" y="844.1948">the latest state to the watcher]</text><polygon fill="#A80036" points="293.5,869.0547,303.5,873.0547,293.5,877.0547,297.5,873.0547" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="135.5" x2="299.5" y1="873.0547" y2="873.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="142.5" y="867.9888">Latest off-chain state</text><path d="M114.5,912.0547 L252.5,912.0547 L252.5,919.0547 L242.5,929.0547 L114.5,929.0547 L114.5,912.0547 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="137.6641" style="stroke:#000000;stroke-width:2.0;" width="447.5" x="114.5" y="912.0547"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="129.5" y="925.1216">Settle phase</text><polygon fill="#A80036" points="293.5,951.3203,303.5,955.3203,293.5,959.3203,297.5,955.3203" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="135.5" x2="299.5" y1="955.3203" y2="955.3203"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="142.5" y="950.2544">Stop watching</text><polygon fill="#A80036" points="482.5,995.5859,492.5,999.5859,482.5,1003.5859,486.5,999.5859" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="315.5" x2="488.5" y1="999.5859" y2="999.5859"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="160" x="322.5" y="979.3872">Unsubscribe from events</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="115" x="322.5" y="994.52">for this channel ID</text><line style="stroke:#A80036;stroke-width:1.0;" x1="135.5" x2="177.5" y1="1028.7188" y2="1028.7188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="177.5" x2="177.5" y1="1028.7188" y2="1041.7188"/><line style="stroke:#A80036;stroke-width:1.0;" x1="136.5" x2="177.5" y1="1041.7188" y2="1041.7188"/><polygon fill="#A80036" points="146.5,1037.7188,136.5,1041.7188,146.5,1045.7188,142.5,1041.7188" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="142.5" y="1023.6528">Settle channel</text><!--MD5=[ad32131dc75dd2dc354757bae727e876]
@startuml watcher
!pragma teoz true
hide footbox

participant "Main component" as main_component
participant "Watching Component\nRemote or Local" as watcher
participant "Blockchain" as blockchain

group Open phase
activate main_component
main_component -> main_component: Open Channel
main_component -> watcher: Start Watching
watcher -> blockchain: Subscribe to events\nfor this channel ID
activate watcher
activate blockchain
end

group Transact phase 
main_component <-> main_component: Off-chain transactions
opt Periodically
main_component -> watcher: Updated off-chain state
watcher -> watcher: Store the new state\nand discard older one
end
end

group Register phase
loop until the stop watching command it received
blockchain -> blockchain: State registered by\nany participant
watcher <- blockchain: State registered\non the blockchain
main_component <- watcher: State registered\non the blockchain
note over main_component, watcher #LightGray
This update is sent to inform the main component
that state has been registered and refutation will
be automatically done by the watcher, if required.
end note
opt if registered state is not latest
watcher -> blockchain: Register latest\noff-chain state
note over watcher #LightGray
Once this succeeds, watcher will receive another
"State registered on the blockchain" notification
end note
end
opt if main component has not sent\nthe latest state to the watcher
main_component -> watcher: Latest off-chain state
end
end
end


group Settle phase 
main_component -> watcher: Stop watching
watcher -> blockchain: Unsubscribe from events\nfor this channel ID
deactivate blockchain
deactivate watcher
main_component -> main_component: Settle channel
end



@enduml

PlantUML version 1.2020.22(Sun Dec 06 15:06:27 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: IN
--></g></svg>