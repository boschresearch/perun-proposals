<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentScriptType="application/ecmascript" contentStyleType="text/css" height="989px" preserveAspectRatio="none" style="width:528px;height:989px;" version="1.1" viewBox="0 0 528 989" width="528px" zoomAndPan="magnify"><defs><filter height="300%" id="fg9nl2a2oodex" width="300%" x="-1" y="-1"><feGaussianBlur result="blurOut" stdDeviation="2.0"/><feColorMatrix in="blurOut" result="blurOut2" type="matrix" values="0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 .4 0"/><feOffset dx="4.0" dy="4.0" in="blurOut2" result="blurOut3"/><feBlend in="SourceGraphic" in2="blurOut3" mode="normal"/></filter></defs><g><rect fill="#FFFFFF" filter="url(#fg9nl2a2oodex)" height="93.3984" style="stroke:#000000;stroke-width:2.0;" width="363" x="8" y="68.5938"/><rect fill="#FFFFFF" filter="url(#fg9nl2a2oodex)" height="185.7969" style="stroke:#000000;stroke-width:2.0;" width="413" x="56" y="174.9922"/><rect fill="#FFFFFF" filter="url(#fg9nl2a2oodex)" height="108.5313" style="stroke:#000000;stroke-width:2.0;" width="369" x="75" y="243.2578"/><rect fill="#FFFFFF" filter="url(#fg9nl2a2oodex)" height="481.8672" style="stroke:#000000;stroke-width:2.0;" width="477.5" x="37" y="373.7891"/><rect fill="#FFFFFF" filter="url(#fg9nl2a2oodex)" height="345.2031" style="stroke:#000000;stroke-width:2.0;" width="433.5" x="56" y="501.4531"/><rect fill="#FFFFFF" filter="url(#fg9nl2a2oodex)" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="387" x="77.5" y="629.1172"/><rect fill="#FFFFFF" filter="url(#fg9nl2a2oodex)" height="61.875" style="stroke:#000000;stroke-width:2.0;" width="309" x="75" y="775.7813"/><rect fill="#FFFFFF" filter="url(#fg9nl2a2oodex)" height="93.3984" style="stroke:#000000;stroke-width:2.0;" width="296" x="75" y="868.6563"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="91" x2="91" y1="56.5938" y2="981.0547"/><rect fill="#FFFFFF" filter="url(#fg9nl2a2oodex)" height="890.3281" style="stroke:#A80036;stroke-width:1.0;" width="10" x="86" y="90.7266"/><line style="stroke:#A80036;stroke-width:1.0;stroke-dasharray:5.0,5.0;" x1="271" x2="271" y1="56.5938" y2="981.0547"/><rect fill="#FFFFFF" filter="url(#fg9nl2a2oodex)" height="757.9297" style="stroke:#A80036;stroke-width:1.0;" width="10" x="266" y="153.9922"/><rect fill="#FEFECE" filter="url(#fg9nl2a2oodex)" height="30.2969" style="stroke:#A80036;stroke-width:1.5;" width="130" x="24" y="21.2969"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="116" x="31" y="41.292">Main component</text><rect fill="#FEFECE" filter="url(#fg9nl2a2oodex)" height="46.5938" style="stroke:#A80036;stroke-width:1.5;" width="164" x="187" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="150" x="194" y="24.9951">Watching Component</text><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacingAndGlyphs" textLength="112" x="213" y="41.292">Remote or Local</text><path d="M8,68.5938 L142,68.5938 L142,75.5938 L132,85.5938 L8,85.5938 L8,68.5938 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="93.3984" style="stroke:#000000;stroke-width:2.0;" width="363" x="8" y="68.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="89" x="23" y="81.6606">Open phase</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="138" y1="111.8594" y2="111.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="138" y1="111.8594" y2="124.8594"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97" x2="138" y1="124.8594" y2="124.8594"/><polygon fill="#A80036" points="107,120.8594,97,124.8594,107,128.8594,103,124.8594" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="103" y="106.7935">Open Channel</text><polygon fill="#A80036" points="254,149.9922,264,153.9922,254,157.9922,258,153.9922" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="260" y1="153.9922" y2="153.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="94" x="103" y="148.9263">Start Watching</text><path d="M56,174.9922 L214,174.9922 L214,181.9922 L204,191.9922 L56,191.9922 L56,174.9922 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="185.7969" style="stroke:#000000;stroke-width:2.0;" width="413" x="56" y="174.9922"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="113" x="71" y="188.0591">Transact phase</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="138" y1="218.2578" y2="218.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="138" y1="218.2578" y2="231.2578"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97" x2="138" y1="231.2578" y2="231.2578"/><polygon fill="#A80036" points="107,227.2578,97,231.2578,107,235.2578,103,231.2578" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="140" x="103" y="213.1919">Off-chain transactions</text><path d="M75,243.2578 L145,243.2578 L145,250.2578 L135,260.2578 L75,260.2578 L75,243.2578 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="108.5313" style="stroke:#000000;stroke-width:2.0;" width="369" x="75" y="243.2578"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="90" y="256.3247">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="85" x="160" y="255.4683">[Periodically]</text><polygon fill="#A80036" points="254,282.5234,264,286.5234,254,290.5234,258,286.5234" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="260" y1="286.5234" y2="286.5234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="151" x="103" y="281.4575">Updated off-chain state</text><line style="stroke:#A80036;stroke-width:1.0;" x1="276" x2="318" y1="330.7891" y2="330.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="318" y1="330.7891" y2="343.7891"/><line style="stroke:#A80036;stroke-width:1.0;" x1="277" x2="318" y1="343.7891" y2="343.7891"/><polygon fill="#A80036" points="287,339.7891,277,343.7891,287,347.7891,283,343.7891" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="126" x="283" y="310.5903">Store the new state</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="138" x="283" y="325.7231">and discard older one</text><path d="M37,373.7891 L194,373.7891 L194,380.7891 L184,390.7891 L37,390.7891 L37,373.7891 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="481.8672" style="stroke:#000000;stroke-width:2.0;" width="477.5" x="37" y="373.7891"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="112" x="52" y="386.856">Register phase</text><line style="stroke:#A80036;stroke-width:1.0;" x1="276" x2="318" y1="432.1875" y2="432.1875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="318" y1="432.1875" y2="445.1875"/><line style="stroke:#A80036;stroke-width:1.0;" x1="277" x2="318" y1="445.1875" y2="445.1875"/><polygon fill="#A80036" points="287,441.1875,277,445.1875,287,449.1875,283,445.1875" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="283" y="411.9888">State registered</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="283" y="427.1216">on the blockchain</text><polygon fill="#A80036" points="107,485.4531,97,489.4531,107,493.4531,103,489.4531" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101" x2="265" y1="489.4531" y2="489.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="113" y="469.2544">State registered</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="113" y="484.3872">on the blockchain</text><path d="M56,501.4531 L133,501.4531 L133,508.4531 L123,518.4531 L56,518.4531 L56,501.4531 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="345.2031" style="stroke:#000000;stroke-width:2.0;" width="433.5" x="56" y="501.4531"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="32" x="71" y="514.52">loop</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="296" x="148" y="513.6636">[until the stop watching command it received]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="276" x2="318" y1="559.8516" y2="559.8516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="318" y1="559.8516" y2="572.8516"/><line style="stroke:#A80036;stroke-width:1.0;" x1="277" x2="318" y1="572.8516" y2="572.8516"/><polygon fill="#A80036" points="287,568.8516,277,572.8516,287,576.8516,283,572.8516" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="283" y="539.6528">State registered</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="283" y="554.7856">on the blockchain</text><polygon fill="#A80036" points="107,613.1172,97,617.1172,107,621.1172,103,617.1172" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="101" x2="265" y1="617.1172" y2="617.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="104" x="113" y="596.9185">State registered</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="112" x="113" y="612.0513">on the blockchain</text><path d="M77.5,629.1172 L147.5,629.1172 L147.5,636.1172 L137.5,646.1172 L77.5,646.1172 L77.5,629.1172 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="133.6641" style="stroke:#000000;stroke-width:2.0;" width="387" x="77.5" y="629.1172"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="92.5" y="642.1841">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="207" x="162.5" y="641.3276">[if registered state is not latest]</text><line style="stroke:#A80036;stroke-width:1.0;" x1="276" x2="318" y1="687.5156" y2="687.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="318" x2="318" y1="687.5156" y2="700.5156"/><line style="stroke:#A80036;stroke-width:1.0;" x1="277" x2="318" y1="700.5156" y2="700.5156"/><polygon fill="#A80036" points="287,696.5156,277,700.5156,287,704.5156,283,700.5156" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="283" y="667.3169">Register latest</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="283" y="682.4497">off-chain state</text><path d="M98.5,713.5156 L98.5,753.5156 L439.5,753.5156 L439.5,723.5156 L429.5,713.5156 L98.5,713.5156 " fill="#D3D3D3" filter="url(#fg9nl2a2oodex)" style="stroke:#A80036;stroke-width:1.0;"/><path d="M429.5,713.5156 L429.5,723.5156 L439.5,723.5156 L429.5,713.5156 " fill="#D3D3D3" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="316" x="104.5" y="730.5825">Once this succeeds, watcher will receieve another</text><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="304" x="104.5" y="745.7153">"State registered on the blockchain" notification</text><path d="M75,775.7813 L145,775.7813 L145,782.7813 L135,792.7813 L75,792.7813 L75,775.7813 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="61.875" style="stroke:#000000;stroke-width:2.0;" width="309" x="75" y="775.7813"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="25" x="90" y="788.8481">opt</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="208" x="160" y="787.9917">[if main component has not sent</text><text fill="#000000" font-family="sans-serif" font-size="11" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="202" x="160" y="800.7964">the latest state to the watcher]</text><polygon fill="#A80036" points="254,825.6563,264,829.6563,254,833.6563,258,829.6563" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="260" y1="829.6563" y2="829.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="136" x="103" y="824.5903">Latest off-chain state</text><path d="M75,868.6563 L213,868.6563 L213,875.6563 L203,885.6563 L75,885.6563 L75,868.6563 " fill="#EEEEEE" style="stroke:#000000;stroke-width:1.0;"/><rect fill="none" height="93.3984" style="stroke:#000000;stroke-width:2.0;" width="296" x="75" y="868.6563"/><text fill="#000000" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacingAndGlyphs" textLength="93" x="90" y="881.7231">Settle phase</text><polygon fill="#A80036" points="254,907.9219,264,911.9219,254,915.9219,258,911.9219" style="stroke:#A80036;stroke-width:1.0;"/><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="260" y1="911.9219" y2="911.9219"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="90" x="103" y="906.856">Stop watching</text><line style="stroke:#A80036;stroke-width:1.0;" x1="96" x2="138" y1="941.0547" y2="941.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="138" x2="138" y1="941.0547" y2="954.0547"/><line style="stroke:#A80036;stroke-width:1.0;" x1="97" x2="138" y1="954.0547" y2="954.0547"/><polygon fill="#A80036" points="107,950.0547,97,954.0547,107,958.0547,103,954.0547" style="stroke:#A80036;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacingAndGlyphs" textLength="92" x="103" y="935.9888">Settle channel</text><!--MD5=[f094ea0acffcba165794655df204803f]
@startuml watcher
!pragma teoz true
hide footbox

participant "Main component" as main_component
participant "Watching Component\nRemote or Local" as watcher

group Open phase
activate main_component
main_component -> main_component: Open Channel
main_component -> watcher: Start Watching
activate watcher
end

group Transact phase 
main_component <-> main_component: Off-chain transactions
opt Periodically
main_component -> watcher: Updated off-chain state
watcher -> watcher: Store the new state\nand discard older one
end
end

group Register phase
watcher -> watcher: State registered\non the blockchain
main_component <- watcher: State registered\non the blockchain
loop until the stop watching command it received
watcher -> watcher: State registered\non the blockchain
main_component <- watcher: State registered\non the blockchain
opt if registered state is not latest
watcher -> watcher: Register latest\noff-chain state
note over watcher #LightGray
Once this succeeds, watcher will receieve another 
"State registered on the blockchain" notification
end note
end
opt if main component has not sent\nthe latest state to the watcher
main_component -> watcher: Latest off-chain state
end
end
end


group Settle phase 
main_component -> watcher: Stop watching
deactivate watcher
main_component -> main_component: Settle channel
end



@enduml

PlantUML version 1.2020.21(Mon Nov 30 22:10:11 IST 2020)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: IN
--></g></svg>